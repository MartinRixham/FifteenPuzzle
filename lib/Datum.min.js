!function(a){"function"==typeof define&&define.amd?define(a):a("object"==typeof module&&module.exports?module.exports:this)}(function(a){a=a||{};var b=function(){function a(a,b){function c(a){return a&&a.applyBinding&&a.removeBinding}var d;a&&c(a)?d=a:a instanceof Array?d=b.createArrayBinding(a):a&&"object"==typeof a&&(d=b.createViewModel(a)),this.applyBinding=function(a,b,c){d&&d.applyBinding(a,b,c)},this.removeBinding=function(){d&&d.removeBinding()},this.isOlderThan=function(b){return("object"==typeof a||"object"==typeof b)&&(b&&a!=b)}}return a}(),c=function(a){function b(b,c,d,e){var f=b.push;b.push=function(){for(var g=0;g<arguments.length;g++){var h=arguments[g],i=new a(h,e);d.push(i);for(var j=0;j<c.length;j++){var k=c[j].element,l=c[j].child;k.appendChild(l.clone()),i.applyBinding(k,d.length-1,h)}}f.apply(this,arguments),b.subscribableLength=b.length}}return b}(b),d=function(){function a(a,b,c){function d(){for(var b=e(),d=[],f=0;f<a.length;f++)d.push({model:a[f],property:c[f],children:b[f]});return d}function e(){for(var a=[],c=0;c<b.length;c++){var d=b[c].element,e=[].slice.call(d.children);f(d);for(var g=0;g<e.length;g++)a[g]||(a[g]=[]),a[g][c]=e[g]}return a}function f(a){for(;a.lastChild;)a.removeChild(a.lastChild)}function g(d){for(var e=0;e<a.length;e++){a[e]=d[e].model,c[e]=d[e].property;for(var f=0;f<b.length;f++){var g=b[f].element;g.appendChild(d[e].children[f])}}}a.sort=function(a){var b=d();b.sort(function(b,c){return a(b.model,c.model)}),g(b)}}return a}(),e=function(){function a(a,b,c){this.call=function(b){a(b)},this.removedFromDocument=function(){return!document.contains(c)},this.equals=function(a){return a.hasEqual(b,c)},this.hasEqual=function(a,d){return b==a&&c==d}}return a}(),f=function(){function a(){this.registerRebinder=function(a){b=a},this.rebindDataStructure=function(){b&&c&&(c=!1,b())},this.requestRebind=function(){b&&(c=!0)}}var b=null,c=!1;return a}(),g=function(){function a(a,b,c){var d=a.pop;a.pop=function(){var e=c.pop();e&&e.removeBinding();for(var f=0;f<b.length;f++){var g=b[f].element;g.lastElementChild&&g.removeChild(g.lastElementChild)}d.apply(this,arguments),a.subscribableLength=a.length}}return a}(),h=function(a){function b(b,c,d,e){var f=b.unshift;b.unshift=function(){for(var g=arguments.length-1;g>=0;g--){var h=arguments[g],i=new a(h,e);d.unshift(i);for(var j=0;j<c.length;j++){var k=c[j].element,l=c[j].child;k.insertBefore(l.clone(),k.firstChild),i.applyBinding(k,0,h)}}f.apply(this,arguments),b.subscribableLength=b.length}}return b}(b),i=function(){function a(a){function b(a,c){if(a.id&&(a.id=a.id+"_"+c),a.hasAttribute&&a.hasAttribute("name")){var d=a.getAttribute("name")+"_"+c;a.setAttribute("name",d)}if(a.children)for(var e=0;e<a.children.length;e++)b(a.children[e],c)}var c=0;this.clone=function(){var d=a.cloneNode(!0);return b(d,c++),d},this.get=function(){return a}}return a}(),j=function(){function a(){this.registerUpdaterAssigner=function(a){c&&b.push(a)},this.requestRegistrations=function(){b=[],c=!0},this.assignUpdater=function(a){for(var d=0;d<b.length;d++)b[d](a);c=!1}}var b=[],c=!1;return a}(),k=function(){function a(a,b,c){function d(a){for(;a.lastChild;)a.removeChild(a.lastChild)}function e(a,b){for(var c=b.length-1;c>=0;c--)a.appendChild(b[c])}var f=a.reverse;a.reverse=function(){for(var a=0;a<b.length;a++){var g=b[a].element,h=[].slice.call(g.children);d(g),e(g,h)}c.reverse(),f.apply(this,arguments)}}return a}(),l=function(){function a(a,b,c){var d=a.shift;a.shift=function(){var e=c.shift();e&&e.removeBinding();for(var f=0;f<b.length;f++){var g=b[f].element;g.firstElementChild&&g.removeChild(g.firstElementChild)}d.apply(this,arguments),a.subscribableLength=a.length}}return a}(),m=function(a){function b(b,c,d,e){function f(a){return a<0&&(a=b.length+a),a=Math.min(b.length,a),a=Math.max(0,a)}function g(a,e){for(var f=0;f<c.length;f++){for(var g=c[f].element,h=Math.min(a+e,b.length)-1,i=h;i>=a;i--)g.removeChild(g.children[i]);d.splice(a,e)}}function h(b,f){for(var g=f.length-1;g>=0;g--){var h=f[g],i=new a(h,e);d.splice(b,0,i);for(var j=0;j<c.length;j++){var k=c[j].element,l=c[j].child;k.insertBefore(l.clone(),k.children[b]),i.applyBinding(k,b,h)}}}var i=b.splice;b.splice=function(a,c){a=f(a);var d=[].slice.call(arguments,2);g(a,c),h(a,d),i.apply(this,arguments),b.subscribableLength=b.length}}return b}(b);a.Datum=function(a,b){function c(c){function d(a){return"undefined"==typeof a?e():void h(a)}function e(){return(new a).registerUpdaterAssigner(f),c}function f(a){g(a)&&k.push(a)}function g(a){for(var b=!1,c=0;c<k.length;c++)k[c].equals(a)&&(b=!0);return!b}function h(a){c=a,i(),j(a),(new b).rebindDataStructure()}function i(){for(var a=0;a<k.length;a++){var b=k[a];b.removedFromDocument()&&k.splice(a,1)}}function j(a){for(var b=0;b<k.length;b++)k[b].call(a)}var k=[];return d}return c}(j,f);var n=function(){function a(a,b){function c(a){return a&&a.applyBinding&&a.removeBinding}var d,e=!1;"object"!=typeof a||c(a)||(d=b.createObjectBinding()),this.applyBinding=function(f,g,h){"function"==typeof a||c(a)||e||(b.injectProperty(a,h,g),e=!0),d&&d.applyBinding(f,g,h)},this.removeBinding=function(){d&&d.removeBinding()}}return a}(),o=function(a,b,c,d,e,f,g,h,i,j){function k(k,l){function m(a){if(1!=a.children.length){var b="An array must be bound to an element with exactly one child.";throw new Error(b)}}function n(b){var c=b.children[0];return b.removeChild(c),new a(c)}var o=[],p=[];!function(){for(var a=0;a<k.length;a++)o.push(new b(k[a],l))}(),function(){new d(k,p,o,l),new e(k,p,o),new f(k,p,o),new g(k,p,o,l),new h(k,p,o),new i(k,p,o),new j(k,p,o,l)}(),function(){var a=new c(k.length);Object.defineProperty(k,"subscribableLength",{get:function(){return a()},set:function(b){a(b)}})}(),this.setUpElement=function(a,b,c){b._rebind=function(){},m(b);var d=n(b);p.push({element:b,child:d});for(var e=0;e<c.length;e++)b.appendChild(d.clone())},this.updateElement=function(a,b,c){for(var d=0;d<o.length;d++)o[d].applyBinding(b,d,c)},this.resetElement=function(a){for(var b,c=0;c<p.length;c++)a==p[c].element&&(b=p[c].child,p.splice(c,1));for(;a.lastChild;)a.removeChild(a.lastChild);a.appendChild(b.get())}}return k}(i,b,a.Datum,c,g,l,h,k,d,m),p=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){c.textContent=a.call(b,c)},this.resetElement=function(a){a.textContent=""},this.call=function(b,c){return a.call(b,c)}}return a}(),q=function(){function a(a){var b=[];this.setUpElement=function(c,d){function e(){a.call(c,d)}b.push({element:d,listener:e}),d.addEventListener("click",e)},this.updateElement=function(){},this.resetElement=function(a){var c;for(c=0;c<b.length;c++){var d=b[c];if(d.element==a){a.removeEventListener("click",d.listener);break}}b.splice(c,1)},this.call=function(b,c){a.call(b,c)}}return a}(),r=function(a,b,c){function d(d){function e(a,b){return isNaN(b)?[].slice.call(a.querySelectorAll("[data-bind="+b+"]")):[a.children[b]]}function f(){for(var a=0;a<l.length;a++){var b=l[a];g(b)&&(d.resetElement(b),l.splice(a,1))}}function g(a){return!document.contains(a)}function h(a,b,e,f){for(var g=0;g<a.length;g++){var h=a[g];i(h,b)&&(l.indexOf(h)+1?d.updateElement(e,h,e&&e[f]):(d.setUpElement(e,h,e&&e[f]),(new c).requestRegistrations(),d.updateElement(e,h,e&&e[f]),j(e,h)))}}function i(a,b){return a=a.parentElement,!a||(a._rebind?a==b:i(a,b))}function j(a,e){function f(b){m||(m=!0,d.updateElement(a,e,b),m=!1)}(new c).assignUpdater(new b(f,d,e))}var k,l=[],m=!1;(new a).requestRebind(),this.applyBinding=function(a,b,c){k=c;var d=e(a,b);f(),h(d,a,c,b),[].push.apply(l,d)},this.removeBinding=function(){for(var a=0;a<l.length;a++)d.resetElement(l[a]);l=[],k=null},this.test={call:function(){var a=[].slice.call(arguments);return a.unshift(k),d.call.apply(d,a)}}}return d}(f,e,j),s=function(){function a(a){var b=[];this.setUpElement=function(c,d){function e(b){a.call(c,b.target.value,d)}b.push({element:d,listener:e}),d.addEventListener("change",e)},this.updateElement=function(b,c){c.value=a.call(b,void 0,c)},this.resetElement=function(a){var c;for(c=0;c<b.length;c++){var d=b[c];if(d.element==a){a.removeEventListener("change",d.listener),a.value="";break}}b.splice(c,1)},this.call=function(b,c,d){return a.call(b,c,d)}}return a}(),t=function(){function a(a){function b(a){a&&a._rebind?a._rebind():a&&b(a.parentElement)}var c=new MutationObserver(function(a){var c=a[0],d=c.target.children.length;if(d){var e=c.target;b(e)}});c.observe(a,{childList:!0,subtree:!0}),this.disconnect=function(){c.disconnect()}}return a}(),u=function(){function a(a){a.toJSON||(a.toJSON=function(){var b={};a instanceof Array&&(b=[]);for(var c in a){var d=a[c];d&&d.toJSON&&"object"==typeof d&&(!d.applyBinding||d instanceof Array)&&(b[c]=d.toJSON()),(!d||"object"!=typeof d&&"function"!=typeof d)&&(b[c]=d)}return b})}return a}(),v=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)},this.resetElement=function(){},this.call=function(b,c){a.call(b,c)}}return a}(),w=function(){function a(a){this.setUpElement=function(b,c){a.call(b,c)},this.updateElement=function(){},this.resetElement=function(){},this.call=function(){a.apply(this,arguments)}}return a}(),x=function(){function a(){var a=[];this.setUpElement=function(b,c){var d=[].slice.call(c.childNodes);a.push({element:c,children:d})},this.updateElement=function(b,c,d){var e;if(d){for(var f=0;f<a.length;f++)if(a[f].element==c){e=a[f].children;break}if(!c.childNodes.length)for(var g=0;g<e.length;g++)c.appendChild(e[g])}else{e=c.childNodes;for(var h=e.length-1;h>=0;h--)c.removeChild(e[h])}},this.resetElement=function(b){for(var c,d=0;d<a.length;d++)if(a[d].element==b){c=a[d].children,a.splice(d,1);break}if(!b.childNodes.length)for(var e=0;e<c.length;e++)b.appendChild(c[e])}}return a}(),y=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)?c.style.display=null:c.style.display="none"},this.resetElement=function(a){a.style.display=null},this.call=function(b,c){return a.call(b,c)}}return a}(),z=function(a,b,c,d){function e(e){this.injectProperty=function(b,c,d){var e=new a(b);Object.defineProperty(c,d,{get:function(){return e()},set:function(a){e(a)}})},this.createViewModel=function(a){return e(a)},this.createObjectBinding=function(){return new b(new c)},this.createArrayBinding=function(a){return new b(new d(a,this))}}return e}(a.Datum,r,x,o),A=function(a,b,c,d){function e(f){function g(a,b){for(var c=h(a,b),d=0;d<c.length;d++){var e=c[d];e&&!i(e,a)||(k(e,a,b),l(e),m(),n(),o(),r(e))}}function h(a,b){if(a){var c=j(a,b);return c.length?c:[null]}return[document.body]}function i(a,b){return a=a.parentElement,!a||(a._rebind?a==b:i(a,b))}function j(a,b){return isNaN(b)?[].slice.call(a.querySelectorAll("[data-bind="+b+"]")):[a.children[b]]}function k(a,b,c){a&&(a._rebind=function(){g(b,c)})}function l(a){f.onBind&&f.onBind(a)}function m(){for(var a in s)f[a]||(s[a].removeBinding(),delete s[a])}function n(){for(var a in f)t[a]||(t[a]=new c(f[a],q()))}function o(){for(var a in f)p(a)&&(s[a]&&s[a].removeBinding(),s[a]=new b(f[a],q()))}function p(a){var b=s[a];return!b||b.isOlderThan&&b.isOlderThan(f[a])}function q(){return new d(function(a){return new e(a)})}function r(a){var b;for(b in t)t[b].applyBinding(a,b,f);for(b in s)s[b].applyBinding(a,b,f)}var s={},t={};new a(f),this.applyBinding=g,this.removeBinding=function(){var a;for(a in t)t[a].removeBinding();for(a in s)s[a].removeBinding()}}return e}(u,b,n,z);return a.Click=function(a,b){function c(c){return new b(new a(c))}return c}(q,r),a.Update=function(a,b){function c(c){return new b(new a(c))}return c}(v,r),a.Text=function(a,b){function c(c){return new b(new a(c))}return c}(p,r),a.Value=function(a,b){function c(c){return new b(new a(c))}return c}(s,r),a.Binding=function(a,b,c,d,e,f,g){function h(h){var i=[];h.text&&i.push(new a(new b(h.text))),h.value&&i.push(new a(new c(h.value))),h.click&&i.push(new a(new d(h.click))),h.init&&i.push(new a(new e(h.init))),h.update&&i.push(new a(new f(h.update))),h.visible&&i.push(new a(new g(h.visible)));var j=null;this.applyBinding=function(a,b,c){j=c;for(var d=0;d<i.length;d++)i[d].applyBinding(a,b,c)},this.removeBinding=function(){for(var a=0;a<i.length;a++)i[a].removeBinding()};var k={};Object.keys(h).forEach(function(a){k[a]=function(b){h[a].call(j,b)}}),this.test=k}return h}(r,p,s,q,w,v,y),a.Init=function(a,b){function c(c){return new b(new a(c))}return c}(w,r),a.Visible=function(a,b){function c(c){return new b(new a(c))}return c}(y,r),a.BindingRoot=function(a,b,c){function d(d){e();var f=new a(d);f.applyBinding(),(new c).registerRebinder(function(){f.applyBinding()});var g=new b(document.body);this.disconnect=function(){g.disconnect()}}function e(){if(f)throw new Error("The binding root is unique and cannot be instantiated multiple times.");f=!0}var f=!1;return d}(A,t,f),a});