!function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports?module.exports=a():a(this)}(function(a){a=a||function(){return a.Datum.apply(this,arguments)};var b=function(){function a(a){var b;this.setUpElement=function(a){b=a},this.updateElement=function(){},this.resetElement=function(c){a.call(b,c)},this.call=function(){init.apply(this,arguments)}}return a}(),c=function(){function a(a,b){function c(a){return a&&a.applyBinding&&a.removeBinding}var d;a&&c(a)?d=a:a instanceof Array?d=b.createArrayBinding(a):a&&"object"==typeof a&&(d=b.createViewModel(a)),this.applyBinding=function(a,b,c){d&&d.applyBinding(a,b,c)},this.removeBinding=function(){d&&d.removeBinding()},this.isOlderThan=function(b){return("object"==typeof a||"object"==typeof b)&&(b&&a!=b)}}return a}(),d=function(){function a(a){function b(a,c){if(a.id&&(a.id=a.id+"_"+c),a.hasAttribute("name")){var d=a.getAttribute("name")+"_"+c;a.setAttribute("name",d)}for(var e=0;e<a.children.length;e++)b(a.children[e],c)}var c=0;this.clone=function(){var d=a.cloneNode(!0);return b(d,c++),d},this.get=function(){return a}}return a}(),e=function(){function a(a,b,c){var d=a.pop;a.pop=function(){var e=d.apply(this,arguments),f=c.pop();f&&f.removeBinding();for(var g=0;g<b.length;g++)b[g].removeLast();return a.subscribableLength=a.length,e}}return a}(),f=function(a){function b(b,c,d,e){var f=b.push;b.push=function(){f.apply(this,arguments);for(var g=0;g<arguments.length;g++){var h=new a(arguments[g],e);d.push(h);for(var i=0;i<c.length;i++){var j=c[i],k=d.length-1;j.append(),h.applyBinding(j.getChildAtIndex(k),b)}}b.subscribableLength=b.length}}return b}(c),g=function(){function a(a,b,c){var d=a.reverse;a.reverse=function(){d.apply(this,arguments);for(var a=0;a<b.length;a++){var e=b[a],f=e.removeChildren();e.appendChildren(f.reverse())}c.reverse()}}return a}(),h=function(){function a(a,b,c){var d=a.shift;a.shift=function(){var e=d.apply(this,arguments),f=c.shift();f&&f.removeBinding();for(var g=0;g<b.length;g++)b[g].removeFirst();return a.subscribableLength=a.length,e}}return a}(),i=function(){function a(a,b,c){function d(){for(var b=e(),d=[],f=0;f<a.length;f++)d.push({model:a[f],property:c[f],children:b[f]});return d}function e(){for(var a=[],c=0;c<b.length;c++)for(var d=b[c].removeChildren(),e=0;e<d.length;e++)a[e]||(a[e]=[]),a[e][c]=d[e];return a}function f(d){for(var e=0;e<a.length;e++){a[e]=d[e].model,c[e]=d[e].property;for(var f=0;f<b.length;f++)b[f].appendChild(d[e].children[f])}}a.sort=function(a){var b=d();b.sort(function(b,c){return a(b.model,c.model)}),f(b)}}return a}(),j=function(a){function b(b,c,d,e){function f(a){return a<0&&(a=b.length+a),a=Math.min(b.length,a),a=Math.max(0,a)}function g(a,e){for(var f=0;f<c.length;f++){for(var g=c[f],h=Math.min(a+e,b.length)-1,i=h;i>=a;i--)g.removeAtIndex(i);d.splice(a,e)}}function h(f,g){for(var h=g.length-1;h>=0;h--){var i=new a(g[h],e);d.splice(f,0,i);for(var j=0;j<c.length;j++){var k=c[j];k.insertAtIndex(f),i.applyBinding(k.getChildAtIndex(f),b)}}}var i=b.splice;b.splice=function(a,c){a=f(a);var d=[].slice.call(arguments,2);g(a,c),h(a,d);var e=i.apply(this,arguments);return b.subscribableLength=b.length,e}}return b}(c),k=function(a){function b(b,c,d,e){var f=b.unshift;b.unshift=function(){f.apply(this,arguments);for(var g=arguments.length-1;g>=0;g--){var h=new a(arguments[g],e);d.unshift(h);for(var i=0;i<c.length;i++){var j=c[i];j.prepend(),h.applyBinding(j.getChildAtIndex(0),b)}}b.subscribableLength=b.length}}return b}(c),l=function(){function a(a,b,c){this.call=function(b){a(b)},this.removedFromDocument=function(){return c.removedFromDocument()},this.equals=function(a){return a.hasEqual(b,c)},this.hasEqual=function(a,d){return b==a&&c.equals(d)}}return a}(),m=function(){function a(a){function b(a){a&&a.__DATUM__REBIND?a.__DATUM__REBIND():a&&b(a.parentElement)}var c=new MutationObserver(function(a){var c=a[0],d=c.target.children.length;if(d){var e=c.target;b(e)}});c.observe(a,{childList:!0,subtree:!0}),this.disconnect=function(){c.disconnect()}}return a}(),n=function(){function a(){this.registerUpdaterAssigner=function(a){c&&b.push(a)},this.requestRegistrations=function(){b=[],c=!0},this.assignUpdater=function(a){for(var d=0;d<b.length;d++)b[d](a);c=!1}}var b=[],c=!1;return a}(),o=function(){function a(a,b,c){function d(a){return a&&a.applyBinding&&a.removeBinding}var e,f=!1;"object"!=typeof a||d(a)||(e=b.createObjectBinding(c)),this.applyBinding=function(c,g,h){"function"==typeof a||d(a)||f||(b.injectProperty(a,g,h),f=!0),e&&e.applyBinding(c,g,h)},this.removeBinding=function(){e&&e.removeBinding()}}return a}(),p=function(){function a(a){a.toJSON||(a.toJSON=function(){var b={};a instanceof Array&&(b=[]);for(var c in a){var d=a[c];d&&d.toJSON&&"object"==typeof d&&(!d.applyBinding||d instanceof Array)&&(b[c]=d.toJSON()),(!d||"object"!=typeof d&&"function"!=typeof d)&&(b[c]=d)}return b})}return a}(),q=function(){function a(a){var b=[].slice.call(a.childNodes);this.removeChildren=function(){for(var b=a.childNodes,c=b.length-1;c>=0;c--)a.removeChild(b[c])},this.replaceChildren=function(){for(var c=0;c<b.length;c++)a.appendChild(b[c])},this.removedFromDocument=function(){return!document.contains(a)},this.equals=function(b){return b.hasEqual(a)},this.hasEqual=function(b){return a==b}}return a}(),r=function(){function a(){this.hasInScope=function(){return!1},this.isInScope=function(){return!0},this.removedFromDocument=function(){return!0},this.getMatchingElements=function(){return[]},this.hasDataBindAttribute=function(){return!1},this.createRebinder=function(){},this.callBindingCallback=function(){},this.equals=function(b){return b instanceof a},this.hasEqual=function(){return!1},this.get=function(){return null}}return a}(),s=function(){function a(){function a(a){for(var c=!0,d=0;d<b.length;d++)b[d].equals(a)&&(c=!1);return c}var b=[];this.add=function(c){a(c)&&b.push(c)},this.removeOld=function(){for(var a=[],c=0;c<b.length;c++){var d=b[c];d.removedFromDocument()&&(b.splice(c,1),a.push(d))}return a},this.getElementEqualTo=function(a){for(var c=0;c<b.length;c++)if(b[c].equals(a))return b[c]},this.contains=function(b){return!a(b)},this.remove=function(a){for(var c=0;c<b.length;c++)b[c].equals(a)&&b.splice(c,1)},this.get=function(){return b}}return a}(),t=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)?c.style.display=null:c.style.display="none"},this.resetElement=function(a){a.style.display=null},this.call=function(b,c){return a.call(b,c)}}return a}(),u=function(){function a(a){var b=[];this.setUpElement=function(c,d){function e(b){a.call(c,b.target.value,d)}b.push({element:d,listener:e}),d.addEventListener("change",e)},this.updateElement=function(b,c){c.value=a.call(b,void 0,c)},this.resetElement=function(a){for(var c=0;c<b.length;c++){var d=b[c];if(d.element==a){a.removeEventListener("change",d.listener),a.value="";break}}b.splice(c,1)},this.call=function(b,c,d){return a.call(b,c,d)}}return a}(),v=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)},this.resetElement=function(){},this.call=function(b,c){a.call(b,c)}}return a}(),w=function(){function a(a){function b(a){var b;return b=a.className?a.className.split(" "):[]}this.setUpElement=function(){},this.updateElement=function(c,d){var e=b(d);for(var f in a){var g=e.indexOf(f);a[f].call(c,d)?g<0&&e.push(f):g+1&&e.splice(g,1)}d.className=e.join(" ")},this.resetElement=function(){},this.call=function(b,c){for(var d in a)a[d].call(b,c)}}return a}(),x=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){c.textContent=a.call(b,c)},this.resetElement=function(a){a.textContent=""},this.call=function(b,c){return a.call(b,c)}}return a}(),y=function(){function a(a){function b(a,b,c){return function(){c.call(a,b)}}var c=[];this.setUpElement=function(d,e){for(var f in a){var g=a[f],h=b(d,e,g);c.push({key:f,element:e,listener:h}),e.addEventListener(f,h)}},this.updateElement=function(){},this.resetElement=function(a){for(var b=0;b<c.length;b++){var d=c[b];d.element==a&&a.removeEventListener(d.key,d.listener)}c.splice(b,1)},this.call=function(b,c){for(var d in a)a[d].call(b,c)}}return a}(),z=function(){function a(a){this.setUpElement=function(b,c){a.call(b,c)},this.updateElement=function(){},this.resetElement=function(){},this.call=function(){a.apply(this,arguments)}}return a}();a.Datum=function(a,b){function c(c){function d(a){return"undefined"==typeof a||a instanceof Node?e():void g(a)}function e(){return(new b).registerUpdaterAssigner(f),c}function f(a){i.add(a)}function g(a){c=a,i.removeOld(),h(a)}function h(a){for(var b=i.get(),c=0;c<b.length;c++)b[c].call(a)}var i=new a;return d}return c}(s,n);var A=function(a,b,c){function d(d){function e(){for(var a=i.removeOld(),b=0;b<a.length;b++){var c=a[b].get();c&&d.resetElement(c)}}function f(a,b){a.get()&&!i.contains(a)&&(d.setUpElement(b,a.get()),(new c).requestRegistrations(),d.updateElement(b,a.get()),g(b,a))}function g(a,e){function f(b){g||(g=!0,d.updateElement(a,e.get(),b),g=!1)}var g=!1;(new c).assignUpdater(new b(f,d,e))}var h,i=new a;this.applyBinding=function(a,b){h=b,e(),f(a,b),i.add(a)},this.removeBinding=function(){for(var a=i.get(),b=0;b<a.length;b++){var c=a[b].get();c&&d.resetElement(c)}h=null},this.test={call:function(){var a=[].slice.call(arguments);return a.unshift(h),d.call.apply(d,a)}}}return d}(s,l,n);a.Destroy=function(a,b){function c(c){return new b(new a(c))}return c}(b,A),a.Update=function(a,b){function c(c){return new b(new a(c))}return c}(v,A),a.Binding=function(a,b,c,d,e,f,g,h,i){function j(j){function k(a,b){n=b;for(var c=0;c<m.length;c++)m[c].applyBinding(a,b)}function l(){for(var a=0;a<m.length;a++)m[a].removeBinding()}var m=[];j.text&&m.push(new a(new b(j.text))),j.value&&m.push(new a(new c(j.value))),j.click&&m.push(new a(new d({click:j.click}))),j.init&&m.push(new a(new e(j.init))),j.update&&m.push(new a(new f(j.update))),j.destroy&&m.push(new a(new h(j.destroy))),j.visible&&m.push(new a(new g(j.visible))),j.events&&m.push(new a(new d(j.events))),j.classes&&m.push(new a(new i(j.classes)));var n=null,o={};return Object.keys(j).forEach(function(a){o[a]=function(b){j[a].call(n,b)}}),{applyBinding:k,removeBinding:l,test:o}}return j}(A,x,u,y,z,v,t,b,w),a.Text=function(a,b){function c(c){return new b(new a(c))}return c}(x,A),a.Init=function(a,b){function c(c){return new b(new a(c))}return c}(z,A);var B=function(a){function b(b,c){var d,e=b.get();!function(){if(1!=e.children.length){var a="An array must be bound to an element with exactly one child.";throw new Error(a)}}(),function(){b.createRebinder(function(){})}(),function(){var b=e.children[0];e.removeChild(b),d=new a(b)}(),function(){for(var a=0;a<c;a++)e.appendChild(d.clone())}(),this.append=function(){e.appendChild(d.clone())},this.prepend=function(){e.insertBefore(d.clone(),e.firstChild)},this.insertAtIndex=function(a){e.insertBefore(d.clone(),e.children[a])},this.removeFirst=function(){e.firstElementChild&&e.removeChild(e.firstElementChild)},this.removeLast=function(){e.lastElementChild&&e.removeChild(e.lastElementChild)},this.removeAtIndex=function(a){e.removeChild(e.children[a])},this.removeChildren=function(){for(var a=[].slice.call(e.children);e.lastChild;)e.removeChild(e.lastChild);return a},this.appendChildren=function(a){for(var b=0;b<a.length;b++)e.appendChild(a[b])},this.appendChild=function(a){e.appendChild(a)},this.reset=function(){for(;e.lastChild;)e.removeChild(e.lastChild);e.appendChild(d.get())},this.getChildAtIndex=function(a){return b.createElement(e.children[a])},this.removedFromDocument=function(){return b.removedFromDocument()},this.equals=function(a){return a.hasEqual(e)},this.hasEqual=function(a){return e==a},this.get=function(){return b}}return b}(d),C=function(a,b,c){function d(d){function e(a,c,e){k.contains(a)?f(a,c&&c[e]):(k.add(a.toObjectElement()),(new b).requestRegistrations(),f(a,c&&c[e]),g(d,a))}function f(a,b){var c=k.getElementEqualTo(a);b?j&&(j=!1,c.replaceChildren()):(j=!0,c.removeChildren())}function g(a,d){function e(){f||(f=!0,a.rebind(),f=!1)}var f=!1;(new b).assignUpdater(new c(e,i,d))}function h(a){for(var b=0;b<a.length;b++){var c=a[b];c.replaceChildren(),k.remove(c)}}var i=this,j=!1,k=new a;this.applyBinding=function(a,b,c){var d=k.removeOld();h(d),a.get()&&e(a,b,c)},this.removeBinding=function(){var a=k.get();h(a)}}return d}(s,n,l);a.Events=function(a,b){function c(c){return new b(new a(c))}return c}(y,A),a.Visible=function(a,b){function c(c){return new b(new a(c))}return c}(t,A),a.Value=function(a,b){function c(c){return new b(new a(c))}return c}(u,A),a.Click=function(a,b){function c(c){return new b(new a({click:c}))}return c}(y,A),a.Classes=function(a,b){function c(c){return new b(new a(c))}return c}(w,A);var D=function(a,b,c,d,e,f,g,h,i,j,k){function l(b,l){function m(a,c,d){p.contains(a)||p.add(a.toArrayElement(b.length));for(var e=p.getElementEqualTo(a),f=c[d],g=0;g<o.length;g++)o[g].applyBinding(e.getChildAtIndex(g),f)}function n(a){for(var b=0;b<a.length;b++){var c=a[b];c.get()&&(c.reset(),p.remove(c))}}var o=[],p=new a;!function(){for(var a=0;a<b.length;a++)o.push(new c(b[a],l))}(),function(){var a=p.get();new e(b,a,o,l),new f(b,a,o),new g(b,a,o),new h(b,a,o,l),new i(b,a,o),new j(b,a,o),new k(b,a,o,l)}(),function(){var a=new d(b.length);Object.defineProperty(b,"subscribableLength",{get:function(){return a()},set:function(b){a(b)}})}(),this.applyBinding=function(a,b,c){var d=p.removeOld();n(d),a.get()&&m(a,b,c)},this.removeBinding=function(){var a=p.get();n(a)}}return l}(s,n,c,a.Datum,f,e,h,k,g,i,j),E=function(a,b,c){function d(d){this.injectProperty=function(b,c,d){var e=new a(b);Object.defineProperty(c,d,{get:function(){return e()},set:function(a){e(a)}})},this.createViewModel=function(a){return d(a)},this.createObjectBinding=function(a){return new b(a)},this.createArrayBinding=function(a){return new c(a,this)}}return d}(a.Datum,C,D),F=function(a,b,c,d,e,f){function g(h){function i(a){r.removeOld(),r.contains(a)||(j(a),a.callBindingCallback(h)),k(),l(a),m(),p(a),r.add(a)}function j(a){a.createRebinder(function(){i(a)})}function k(){for(var a in s)h[a]||(s[a].removeBinding(),delete s[a])}function l(a){for(var b in h)t[b]||(t[b]=new d(h[b],o(),a))}function m(){for(var a in h)n(a)&&(s[a]&&s[a].removeBinding(),s[a]=new c(h[a],o()))}function n(a){var b=s[a];return!b||b.isOlderThan(h[a])}function o(){return new e(function(a){return new g(a)})}function p(a){for(var b in t)for(var c=q(a,b),d=0;d<c.length;d++){var e=c[d];t[b].applyBinding(e,h,b),s[b].applyBinding(e,h,b)}}function q(a,b){var c=a.getMatchingElements(b);return c.length?c:[new f]}var r=new a,s={},t={};new b(h),this.applyBinding=i,this.removeBinding=function(){for(var a in t)t[a].removeBinding(),s[a].removeBinding()}}return g}(s,p,c,o,E,r),G=function(a,b){function c(d){function e(a,b){var c=a.parentElement;return!!c&&(c==b||!c.__DATUM__REBIND&&e(c,b))}this.isInScope=function(a){return e(d,a)},this.removedFromDocument=function(){return!document.contains(d)},this.getMatchingElements=function(a){for(var b=d.querySelectorAll("[data-bind="+a+"]"),e=[],f=0;f<b.length;f++){var g=new c(b[f]);g.isInScope(d)&&e.push(g)}return e},this.hasDataBindAttribute=function(a){return d.dataset.bind==a},this.createRebinder=function(a){d.__DATUM__REBIND=a},this.rebind=function(){d.__DATUM__REBIND()},this.callBindingCallback=function(a){a.onBind&&a.onBind(d)},this.equals=function(a){return a.hasEqual(d)},this.hasEqual=function(a){return d==a},this.toObjectElement=function(){return new a(d)},this.toArrayElement=function(a){return new b(this,a)},this.get=function(){return d},this.createElement=function(a){return new c(a)}}return c}(q,B);a.BindingRoot=function(a,b,c){function d(d){function f(){h.disconnect()}!function(){if("object"!=typeof d)throw new Error("The binding root must be an object.");if(d instanceof Array)throw new Error("The binding root cannot be an array.")}(),function(){if(e)throw new Error("The binding root is unique and cannot be instantiated multiple times.");e=!0}();var g=new a(d);g.applyBinding(new c(document.body));var h=new b(document.body);return{disconnect:f}}var e=!1;return d}(F,m,G);(function(a){function b(){this.hasInScope=function(a){return a.isInScope(document.body)},this.getMatchingElements=function(){return[new a(document.body)]},this.createRebinder=function(){},this.callBindingCallback=function(){}}return b})(G);return a});