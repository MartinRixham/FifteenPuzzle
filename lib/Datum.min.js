!function(a){"function"==typeof define&&define.amd?define(a):a("object"==typeof module&&module.exports?module.exports:this)}(function(a){a=a||{};var b=function(){function a(b){function c(a,b){var d=a.parentElement;return!d||(d._rebind?d==b:c(d,b))}this.hasInScope=function(a){return a.isInScope(b)},this.isInScope=function(a){return c(b,a)},this.removedFromDocument=function(){return!document.contains(b)},this.getMatchingElements=function(c){if(isNaN(c)){var d=b.querySelectorAll("[data-bind="+c+"]"),e=[].slice.call(d);return e.map(function(b){return new a(b)})}return[new a(b.children[c])]},this.createRebinder=function(a){b&&(b._rebind=a)},this.callBindingCallback=function(a){a.onBind&&a.onBind(b)},this.equals=function(a){return a.hasEqual(b)},this.hasEqual=function(a){return b==a},this.get=function(){return b}}return a}(),c=function(){function a(a,b){function c(a){return a&&a.applyBinding&&a.removeBinding}var d;a&&c(a)?d=a:a instanceof Array?d=b.createArrayBinding(a):a&&"object"==typeof a&&(d=b.createViewModel(a)),this.applyBinding=function(a,b,c){d&&d.applyBinding(a,b,c)},this.removeBinding=function(){d&&d.removeBinding()},this.isOlderThan=function(b){return("object"==typeof a||"object"==typeof b)&&(b&&a!=b)}}return a}(),d=function(){function a(a,b,c){var d=a.pop;a.pop=function(){d.apply(this,arguments);var e=c.pop();e&&e.removeBinding();for(var f=0;f<b.length;f++){var g=b[f].element;g.lastElementChild&&g.removeChild(g.lastElementChild)}a.subscribableLength=a.length}}return a}(),e=function(){function a(){function a(a){for(var c=!0,d=0;d<b.length;d++)b[d].equals(a)&&(c=!1);return c}var b=[];this.add=function(c){a(c)&&b.push(c)},this.removeOld=function(){for(var a=[],c=0;c<b.length;c++){var d=b[c];d.removedFromDocument()&&(b.splice(c,1),a.push(d))}return a},this.contains=function(b){return!a(b)},this.get=function(){return b}}return a}(),f=function(){function a(){this.registerRebinder=function(a){b=a},this.rebindDataStructure=function(){b&&c&&(c=!1,b())},this.requestRebind=function(){b&&(c=!0)}}var b=null,c=!1;return a}(),g=function(){function a(){this.registerUpdaterAssigner=function(a){c&&b.push(a)},this.requestRegistrations=function(){b=[],c=!0},this.assignUpdater=function(a){for(var d=0;d<b.length;d++)b[d](a);c=!1}}var b=[],c=!1;return a}();a.Datum=function(a,b,c){function d(d){function e(a){return"undefined"==typeof a?f():void h(a)}function f(){return(new b).registerUpdaterAssigner(g),d}function g(a){j.add(a)}function h(a){d=a,j.removeOld(),i(a),(new c).rebindDataStructure()}function i(a){for(var b=j.get(),c=0;c<b.length;c++)b[c].call(a)}var j=new a;return e}return d}(e,g,f);var h=function(a,b){function c(c,d,e,f){var g=c.unshift;c.unshift=function(){g.apply(this,arguments);for(var h=arguments.length-1;h>=0;h--){var i=new a(arguments[h],f);e.unshift(i);for(var j=0;j<d.length;j++){var k=d[j].element,l=d[j].child;k.insertBefore(l.clone(),k.firstChild),i.applyBinding(new b(k),0,c)}}c.subscribableLength=c.length}}return c}(c,b),i=function(){function a(a){function b(a,c){if(a.id&&(a.id=a.id+"_"+c),a.hasAttribute&&a.hasAttribute("name")){var d=a.getAttribute("name")+"_"+c;a.setAttribute("name",d)}if(a.children)for(var e=0;e<a.children.length;e++)b(a.children[e],c)}var c=0;this.clone=function(){var d=a.cloneNode(!0);return b(d,c++),d},this.get=function(){return a}}return a}(),j=function(){function a(a,b,c){this.call=function(b){a(b)},this.removedFromDocument=function(){return c.removedFromDocument()},this.equals=function(a){return a.hasEqual(b,c)},this.hasEqual=function(a,d){return b==a&&c.equals(d)}}return a}(),k=function(a,b){function c(c,d,e,f){var g=c.push;c.push=function(){g.apply(this,arguments);for(var h=0;h<arguments.length;h++){var i=new a(arguments[h],f);e.push(i);for(var j=0;j<d.length;j++){var k=d[j].element,l=d[j].child,m=e.length-1;k.appendChild(l.clone()),i.applyBinding(new b(k),m,c)}}c.subscribableLength=c.length}}return c}(c,b),l=function(){function a(a,b,c){function d(a){for(;a.lastChild;)a.removeChild(a.lastChild)}function e(a,b){for(var c=b.length-1;c>=0;c--)a.appendChild(b[c])}var f=a.reverse;a.reverse=function(){f.apply(this,arguments);for(var a=0;a<b.length;a++){var g=b[a].element,h=[].slice.call(g.children);d(g),e(g,h)}c.reverse()}}return a}(),m=function(){function a(a,b,c){var d=a.shift;a.shift=function(){d.apply(this,arguments);var e=c.shift();e&&e.removeBinding();for(var f=0;f<b.length;f++){var g=b[f].element;g.firstElementChild&&g.removeChild(g.firstElementChild)}a.subscribableLength=a.length}}return a}(),n=function(){function a(a,b,c){function d(){for(var b=e(),d=[],f=0;f<a.length;f++)d.push({model:a[f],property:c[f],children:b[f]});return d}function e(){for(var a=[],c=0;c<b.length;c++){var d=b[c].element,e=[].slice.call(d.children);f(d);for(var g=0;g<e.length;g++)a[g]||(a[g]=[]),a[g][c]=e[g]}return a}function f(a){for(;a.lastChild;)a.removeChild(a.lastChild)}function g(d){for(var e=0;e<a.length;e++){a[e]=d[e].model,c[e]=d[e].property;for(var f=0;f<b.length;f++){var g=b[f].element;g.appendChild(d[e].children[f])}}}a.sort=function(a){var b=d();b.sort(function(b,c){return a(b.model,c.model)}),g(b)}}return a}(),o=function(a,b){function c(c,d,e,f){function g(a){return a<0&&(a=c.length+a),a=Math.min(c.length,a),a=Math.max(0,a)}function h(a,b){for(var f=0;f<d.length;f++){for(var g=d[f].element,h=Math.min(a+b,c.length)-1,i=h;i>=a;i--)g.removeChild(g.children[i]);e.splice(a,b)}}function i(g,h){for(var i=h.length-1;i>=0;i--){var j=new a(h[i],f);e.splice(g,0,j);for(var k=0;k<d.length;k++){var l=d[k].element,m=d[k].child;l.insertBefore(m.clone(),l.children[g]),j.applyBinding(new b(l),g,c)}}}var j=c.splice;c.splice=function(a,b){a=g(a);var d=[].slice.call(arguments,2);h(a,b),i(a,d),j.apply(this,arguments),c.subscribableLength=c.length}}return c}(c,b),p=function(a,b,c){function d(d){function e(){for(var a=i.removeOld(),b=0;b<a.length;b++){var c=a[b].get();c&&d.resetElement(c)}}function f(a){for(var b=0;b<a.length;b++)i.add(a[b])}function g(a,b,e,f){for(var g=0;g<a.length;g++){var j=a[g];b.hasInScope(j)&&(i.contains(j)?d.updateElement(e,j.get(),e&&e[f]):(d.setUpElement(e,j.get(),e&&e[f]),(new c).requestRegistrations(),d.updateElement(e,j.get(),e&&e[f]),h(e,j)))}}function h(a,e){function f(b){d.updateElement(a,e.get(),b)}(new c).assignUpdater(new b(f,d,e))}var i=new a;this.applyBinding=function(a,b,c){e();var d=a.getMatchingElements(b);g(d,a,c,b),f(d)},this.removeBinding=function(){for(var a=i.get(),b=0;b<a.length;b++){var c=a[b].get();c&&d.resetElement(c)}}}return d}(e,j,g),q=function(){function a(){var a=[];this.setUpElement=function(b,c){var d=[].slice.call(c.childNodes);a.push({element:c,children:d})},this.updateElement=function(b,c,d){var e;if(d){for(var f=0;f<a.length;f++)if(a[f].element==c){e=a[f].children;break}if(!c.childNodes.length)for(var g=0;g<e.length;g++)c.appendChild(e[g])}else{e=c.childNodes;for(var h=e.length-1;h>=0;h--)c.removeChild(e[h])}},this.resetElement=function(b){for(var c,d=0;d<a.length;d++)if(a[d].element==b){c=a[d].children,a.splice(d,1);break}if(!b.childNodes.length)for(var e=0;e<c.length;e++)b.appendChild(c[e])}}return a}(),r=function(){function a(a,b){function c(a){return a&&a.applyBinding&&a.removeBinding}var d,e=!1;"object"!=typeof a||c(a)||(d=b.createObjectBinding()),this.applyBinding=function(f,g,h){"function"==typeof a||c(a)||e||(b.injectProperty(a,h,g),e=!0),d&&d.applyBinding(f,g,h)},this.removeBinding=function(){d&&d.removeBinding()}}return a}(),s=function(){function a(a){var b=[];this.setUpElement=function(c,d){function e(b){a.call(c,b.target.value,d)}b.push({element:d,listener:e}),d.addEventListener("change",e)},this.updateElement=function(b,c){c.value=a.call(b,void 0,c)},this.resetElement=function(a){var c;for(c=0;c<b.length;c++){var d=b[c];if(d.element==a){a.removeEventListener("change",d.listener),a.value="";break}}b.splice(c,1)},this.call=function(b,c,d){return a.call(b,c,d)}}return a}(),t=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){c.textContent=a.call(b,c)},this.resetElement=function(a){a.textContent=""},this.call=function(b,c){return a.call(b,c)}}return a}(),u=function(){function a(a){function b(a){a&&a._rebind?a._rebind():a&&b(a.parentElement)}var c=new MutationObserver(function(a){var c=a[0],d=c.target.children.length;if(d){var e=c.target;b(e)}});c.observe(a,{childList:!0,subtree:!0}),this.disconnect=function(){c.disconnect()}}return a}(),v=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)},this.resetElement=function(){},this.call=function(b,c){a.call(b,c)}}return a}(),w=function(a,b,c,d){function e(e){function f(){for(var a=k.removeOld(),b=0;b<a.length;b++){var c=a[b].get();c&&e.resetElement(c)}}function g(a){for(var b=0;b<a.length;b++)k.add(a[b])}function h(a,b,c){for(var f=0;f<a.length;f++){var g=a[f];b.hasInScope(g)&&(k.contains(g)||(e.setUpElement(c,g.get()),(new d).requestRegistrations(),e.updateElement(c,g.get()),i(c,g)))}}function i(a,b){function f(c){l||(l=!0,e.updateElement(a,b.get(),c),l=!1)}(new d).assignUpdater(new c(f,e,b))}var j,k=new a,l=!1;(new b).requestRebind(),this.applyBinding=function(a,b,c){j=c,f();var d=a.getMatchingElements(b);h(d,a,c),g(d)},this.removeBinding=function(){for(var a=k.get(),b=0;b<a.length;b++){var c=a[b].get();c&&e.resetElement(c)}j=null},this.test={call:function(){var a=[].slice.call(arguments);return a.unshift(j),e.call.apply(e,a)}}}return e}(e,f,j,g),x=function(a,b,c,d,e,f,g,h,i,j,k){function l(l,m){function n(a){if(1!=a.children.length){var b="An array must be bound to an element with exactly one child.";throw new Error(b)}}function o(b){var c=b.children[0];return b.removeChild(c),new a(c)}var p=[],q=[];!function(){for(var a=0;a<l.length;a++)p.push(new b(l[a],m))}(),function(){new d(l,q,p,m),new e(l,q,p),new f(l,q,p),new g(l,q,p,m),new h(l,q,p),new i(l,q,p),new j(l,q,p,m)}(),function(){var a=new c(l.length);Object.defineProperty(l,"subscribableLength",{get:function(){return a()},set:function(b){a(b)}})}(),this.setUpElement=function(a,b,c){b._rebind=function(){},n(b);var d=o(b);q.push({element:b,child:d});for(var e=0;e<c.length;e++)b.appendChild(d.clone())},this.updateElement=function(a,b,c){for(var d=0;d<p.length;d++)p[d].applyBinding(new k(b),d,c)},this.resetElement=function(a){for(var b,c=0;c<q.length;c++)a==q[c].element&&(b=q[c].child,q.splice(c,1));for(;a.lastChild;)a.removeChild(a.lastChild);a.appendChild(b.get())}}return l}(i,c,a.Datum,k,d,m,h,l,n,o,b),y=function(a){function b(){this.hasInScope=function(a){return a.isInScope(document.body)},this.getMatchingElements=function(){return[new a(document.body)]}}return b}(b),z=function(){function a(a){a.toJSON||(a.toJSON=function(){var b={};a instanceof Array&&(b=[]);for(var c in a){var d=a[c];d&&d.toJSON&&"object"==typeof d&&(!d.applyBinding||d instanceof Array)&&(b[c]=d.toJSON()),(!d||"object"!=typeof d&&"function"!=typeof d)&&(b[c]=d)}return b})}return a}(),A=function(){function a(a){var b=[];this.setUpElement=function(c,d){function e(){a.call(c,d)}b.push({element:d,listener:e}),d.addEventListener("click",e)},this.updateElement=function(){},this.resetElement=function(a){var c;for(c=0;c<b.length;c++){var d=b[c];if(d.element==a){a.removeEventListener("click",d.listener);break}}b.splice(c,1)},this.call=function(b,c){a.call(b,c)}}return a}(),B=function(){function a(a){this.setUpElement=function(b,c){a.call(b,c)},this.updateElement=function(){},this.resetElement=function(){},this.call=function(){a.apply(this,arguments)}}return a}(),C=function(){function a(){this.hasInScope=function(){return!1},this.isInScope=function(){return!0},this.removedFromDocument=function(){return!0},this.getMatchingElements=function(){return[new a]},this.createRebinder=function(){},this.callBindingCallback=function(){},this.equals=function(b){return b instanceof a},this.hasEqual=function(){return!1},this.get=function(){return null}}return a}(),D=function(){function a(a){this.setUpElement=function(){},this.updateElement=function(b,c){a.call(b,c)?c.style.display=null:c.style.display="none"},this.resetElement=function(a){a.style.display=null},this.call=function(b,c){return a.call(b,c)}}return a}(),E=function(a,b,c,d){function e(e){this.injectProperty=function(b,c,d){var e=new a(b);Object.defineProperty(c,d,{get:function(){return e()},set:function(a){e(a)}})},this.createViewModel=function(a){return e(a)},this.createObjectBinding=function(){return new b(new c)},this.createArrayBinding=function(a){return new b(new d(a,this))}}return e}(a.Datum,p,q,x),F=function(a,b,c,d,e,f,g){function h(f){function i(a,b){s.removeOld();for(var c=j(a,b),d=0;d<c.length;d++)k(c[d],a,b)}function j(a,b){var c=a.getMatchingElements(b);return c.length?c:[new g]}function k(a,b,c){b.hasInScope(a)&&(s.contains(a)||(l(a,b,c),a.callBindingCallback(f)),m(),n(),o(),r(a),s.add(a))}function l(a,b,c){a.createRebinder(function(){i(b,c)})}function m(){for(var a in t)f[a]||(t[a].removeBinding(),delete t[a])}function n(){for(var a in f)u[a]||(u[a]=new d(f[a],q()))}function o(){for(var a in f)p(a)&&(t[a]&&t[a].removeBinding(),t[a]=new c(f[a],q()))}function p(a){var b=t[a];return!b||b.isOlderThan(f[a])}function q(){return new e(function(a){return new h(a)})}function r(a){var b;for(b in u)u[b].applyBinding(a,b,f);for(b in t)t[b].applyBinding(a,b,f)}var s=new a,t={},u={};new b(f),this.applyBinding=i,this.removeBinding=function(){var a;for(a in u)u[a].removeBinding();for(a in t)t[a].removeBinding()}}return h}(e,z,c,r,E,b,C);return a.Click=function(a,b){function c(c){return new b(new a(c))}return c}(A,w),a.Update=function(a,b){function c(c){return new b(new a(c))}return c}(v,w),a.Text=function(a,b){function c(c){return new b(new a(c))}return c}(t,w),a.Value=function(a,b){function c(c){return new b(new a(c))}return c}(s,w),a.Binding=function(a,b,c,d,e,f,g){function h(h){var i=[];h.text&&i.push(new a(new b(h.text))),h.value&&i.push(new a(new c(h.value))),h.click&&i.push(new a(new d(h.click))),h.init&&i.push(new a(new e(h.init))),h.update&&i.push(new a(new f(h.update))),h.visible&&i.push(new a(new g(h.visible)));var j=null;this.applyBinding=function(a,b,c){j=c;for(var d=0;d<i.length;d++)i[d].applyBinding(a,b,c)},this.removeBinding=function(){for(var a=0;a<i.length;a++)i[a].removeBinding()};var k={};Object.keys(h).forEach(function(a){k[a]=function(b){h[a].call(j,b)}}),this.test=k}return h}(w,t,s,A,B,v,D),a.Init=function(a,b){function c(c){return new b(new a(c))}return c}(B,w),a.Visible=function(a,b){function c(c){return new b(new a(c))}return c}(D,w),a.BindingRoot=function(a,b,c,d){function e(e){f(e),g();var h=new a(e);h.applyBinding(new d),(new c).registerRebinder(function(){h.applyBinding(new d)});var i=new b(document.body);this.disconnect=function(){i.disconnect()}}function f(a){if("object"!=typeof a)throw new Error("The binding root must be an object.");if(a instanceof Array)throw new Error("The binding root cannot be an array.")}function g(){if(h)throw new Error("The binding root is unique and cannot be instantiated multiple times.");h=!0}var h=!1;return e}(F,u,f,y),a});